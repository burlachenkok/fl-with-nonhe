#!/usr/bin/env bash

# RESNET DCGD PERMK AES
python run.py --rounds "5000" --client-sampling-type "uniform" --num-clients-per-round "10"  --global-lr "${g_lr}" --global-optimiser "SGD" --global-weight-decay "0.0" --number-of-local-iters "1" --batch-size "64" --local-lr "1" --local-optimiser "SGD" --local-weight-decay "0.0005" --dataset "cifar10_fl" --loss "CROSSENTROPY" --model "tv_resnet18" --metric "top_1_acc" --global-regulizer "none" --global-regulizer-alpha "0.0" --checkpoint-dir "../check_points" --do-not-save-eval-checkpoints --data-path "../data/" --compute-type "fp32" --gpu "2" --log-gpu-usage --num-workers-train "4" --num-workers-test "4" --deterministic --manual-init-seed "123" --manual-runtime-seed "456" --group-name "" --comment "" --hostname "mjbook" --eval-every "10" --eval-async-threads "0" --save-async-threads "0" --threadpool-for-local-opt "0" --run-id "dcgd_${g_lr}_${job_id}" --algorithm "dcgd" --algorithm-options "internal_sgd:iterated-minibatch,reshuffle:once_per_client,tau:10%,aes:1"  --logfile "../logs/DCGD_${g_lr}.txt" --client-compressor "permk" --extra-track "full_gradient_norm_train,full_objective_value_train,full_gradient_norm_val,full_objective_value_val" --allow-use-nv-tensorcores --initialize-shifts-policy "zero" --wandb-key "${wandb_key}" --wandb-project-name "dcgd_resnet" --loglevel "DEBUG" --logfilter ".*"  --out "dcgd_${g_lr}.bin" --run-local-steps 

# RESNET FEDAVG
python run.py --rounds "5000" --client-sampling-type "uniform" --num-clients-per-round "10"  --global-lr "${g_lr}" --global-optimiser "SGD" --global-weight-decay "0.0" --number-of-local-iters "1" --batch-size "64" --local-lr "1" --local-optimiser "SGD" --local-weight-decay "0.0005" --dataset "cifar10_fl" --loss "CROSSENTROPY" --model "tv_resnet18" --metric "top_1_acc" --global-regulizer "none" --global-regulizer-alpha "0.0" --checkpoint-dir "../check_points" --do-not-save-eval-checkpoints --data-path "../data/" --compute-type "fp32" --gpu "1" --log-gpu-usage --num-workers-train "4" --num-workers-test "4" --deterministic --manual-init-seed "123" --manual-runtime-seed "456" --group-name "" --comment "" --hostname "mjbook" --eval-every "10" --eval-async-threads "0" --save-async-threads "0" --threadpool-for-local-opt "0" --run-id "fedavg_${g_lr}_${job_id}" --algorithm "FEDAVG" --algorithm-options "internal_sgd:iterated-minibatch,reshuffle:once_per_client,tau:10%"  --logfile "../logs/DCGD_${g_lr}.txt" --client-compressor "ident" --extra-track "full_gradient_norm_train,full_objective_value_train,full_gradient_norm_val,full_objective_value_val" --allow-use-nv-tensorcores --initialize-shifts-policy "zero" --wandb-key "${wandb_key}" --wandb-project-name "fedavg_resnet" --loglevel "DEBUG" --logfilter ".*"  --out "fedavg_${g_lr}.bin" --run-local-steps 